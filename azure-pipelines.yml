trigger:
  - master  # or your default branch

pool:
  name: Barenexus_Pool   # your self-hosted agent pool

steps:
  # 1. Checkout the repo
  - checkout: self
    clean: true

  # 2. Use Node.js 20
  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: 'Use Node.js 20'

  # 3. Install npm dependencies
  - script: |
      npm ci --legacy-peer-deps
    workingDirectory: $(System.DefaultWorkingDirectory)
    displayName: 'Install dependencies'

  # 4. Build React app
  - script: |
      npm run build
    workingDirectory: $(System.DefaultWorkingDirectory)
    displayName: 'Build React app'

  # 5. Deploy to Azure Static Web App
  - task: AzureStaticWebApp@0
    inputs:
      app_location: "/"                # folder with your source code
      output_location: "build"         # React build folder
      azure_static_web_apps_api_token: $(swa_token)  # secret variable
    env:
      NPM_CONFIG_LEGACY_PEER_DEPS: true
    displayName: 'Deploy to Azure Static Web App'
