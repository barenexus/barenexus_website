trigger:
  - master   # or "master" if that's your default branch

pool:
  name: Barenexus_Pool

steps:
  - checkout: self
    clean: true

    # Optional: Fix permissions if needed
  - script: |
      echo "Fixing workspace permissions..."
      sudo chown -R $(whoami) $(System.DefaultWorkingDirectory)
      sudo chmod -R u+rwX $(System.DefaultWorkingDirectory)
    displayName: 'Fix workspace permissions'

  # Use Node.js 20
  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: 'Use Node.js 20'

  # Install dependencies
  - script: |
      npm ci --legacy-peer-deps
    displayName: 'Install dependencies'
    workingDirectory: $(System.DefaultWorkingDirectory)

  # Build React app
  - script: |
      npm run build
    displayName: 'Build React app'
    workingDirectory: $(System.DefaultWorkingDirectory)

  - task: AzureStaticWebApp@0
    inputs:
      app_location: "/"
      output_location: "build"
      azure_static_web_apps_api_token: $(swa_token)
    env:
      NPM_CONFIG_LEGACY_PEER_DEPS: true
    displayName: 'Deploy to Azure Static Web App'
